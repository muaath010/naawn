<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù†Ø¸Ø§Ù… Ù†Ø¹Ø§ÙˆÙ† Ø§Ù„Ù…ÙˆØ­Ø¯</title>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root { --gold: #D4AF37; --red: #8a0909; --bg: #120000; }
        * { box-sizing: border-box; font-family: 'Tajawal', sans-serif; }
        body { background: radial-gradient(circle, #4a0404, var(--bg)); color: #fff; min-height: 100vh; margin: 0; padding: 15px; text-align: center; }
        
        .card { background: rgba(0,0,0,0.85); border: 1px solid var(--gold); border-radius: 15px; padding: 20px; max-width: 600px; margin: 15px auto; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        .logo { width: 90px; height: 90px; border-radius: 50%; border: 2px solid var(--gold); margin-bottom: 10px; }
        
        input, textarea { width: 100%; padding: 12px; margin: 8px 0; border-radius: 8px; border: 1px solid #444; background: #000; color: #fff; text-align: center; font-size: 1rem; }
        .btn { width: 100%; padding: 15px; border-radius: 10px; border: none; font-weight: bold; cursor: pointer; transition: 0.3s; margin-top: 10px; font-size: 1.1rem; }
        .btn-gold { background: var(--gold); color: #000; }
        .btn-outline { background: transparent; color: #fff; border: 1px solid var(--gold); }
        
        .screen { display: none; animation: fadeIn 0.4s ease; }
        .active { display: block; }
        
        /* Ø³ØªØ§ÙŠÙ„ Ø§Ù„Ø¬Ø¯ÙˆÙ„ ÙˆØ§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª */
        .stats-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 20px; }
        .stat-card { background: rgba(212,175,55,0.1); padding: 10px; border-radius: 8px; border: 1px solid var(--gold); }
        .stat-card span { display: block; font-size: 1.2rem; font-weight: bold; }

        .table-container { width: 100%; max-height: 400px; overflow-y: auto; border: 1px solid var(--gold); border-radius: 10px; margin-top: 15px; }
        table { width: 100%; border-collapse: collapse; font-size: 0.85rem; }
        th { position: sticky; top: 0; background: var(--gold); color: #000; padding: 10px; }
        td { padding: 10px; border: 1px solid rgba(212,175,55,0.2); }
        tr:nth-child(even) { background: rgba(255,255,255,0.05); }

        #loader { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.8); z-index: 1000; flex-direction: column; justify-content: center; align-items: center; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

    <div id="loader"><p style="color:var(--gold)">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</p></div>

    <img src="https://i.postimg.cc/htw4PMrc/nskht-mn-Beige-Orange-Simple-Illustration-Pickup-and-Delivery-Service-instagram-Post.jpg" class="logo">
    <h2 style="color:var(--gold); margin: 5px 0;">ÙØ±ÙŠÙ‚ Ù†Ø¹Ø§ÙˆÙ†</h2>

    <div id="mainScreen" class="screen active">
        <div class="card">
            <button onclick="showScreen('orderScreen')" class="btn btn-gold">â• ØªØ³Ø¬ÙŠÙ„ Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯</button>
            <button onclick="showScreen('loginScreen')" class="btn btn-outline">ğŸ”’ Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù†Ø¸Ø§Ù… (Ù…Ù„Ø®Øµ)</button>
        </div>
    </div>

    <div id="orderScreen" class="screen">
        <div class="card">
            <h3>Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ù„Ø¨ÙŠØ©</h3>
            <form id="orderForm">
                <input type="text" name="restaurant" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø·Ø¹Ù…" required>
                <input type="text" name="driver" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨" required>
                <input type="text" name="card" placeholder="Ø±Ù‚Ù… Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©">
                <input type="text" name="location" placeholder="Ø§Ù„Ù…ÙƒØ§Ù†" required>
                <input type="date" name="date" id="dateField" required>
                <input type="number" name="count" placeholder="Ø§Ù„Ø¹Ø¯Ø¯" required>
                <input type="text" name="amount" placeholder="Ø§Ù„Ù…Ø¨Ù„Øº (0.800)" required>
                <textarea name="details" placeholder="Ù…Ù„Ø§Ø­Ø¸Ø§Øª"></textarea>
                <button type="submit" class="btn btn-gold">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„</button>
                <button type="button" onclick="showScreen('mainScreen')" class="btn btn-outline">Ø±Ø¬ÙˆØ¹</button>
            </form>
        </div>
    </div>

    <div id="loginScreen" class="screen">
        <div class="card">
            <h3>ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø·Ø§Ø¹Ù…</h3>
            <form id="loginForm">
                <input type="text" name="username" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… (Ø§Ù„Ù…Ø·Ø¹Ù…)" required>
                <input type="password" name="password" placeholder="Ø§Ù„Ø±Ù…Ø² Ø§Ù„Ø³Ø±ÙŠ" required>
                <button type="submit" class="btn btn-gold">Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù„Ø®Øµ</button>
                <button type="button" onclick="showScreen('mainScreen')" class="btn btn-outline">Ø±Ø¬ÙˆØ¹</button>
            </form>
        </div>
    </div>

    <div id="summaryScreen" class="screen">
        <div class="card">
            <h3 id="welcomeMsg" style="color:var(--gold)"></h3>
            
            <div class="stats-grid">
                <div class="stat-card">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø·Ù„Ø¨Ø§Øª <span id="statOrders">0</span></div>
                <div class="stat-card">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¨Ø§Ù„Øº <span id="statAmount">0.000</span></div>
            </div>

            <div class="table-container" id="tableContent">
                </div>

            <button onclick="location.reload()" class="btn btn-outline" style="margin-top:20px;">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button>
        </div>
    </div>

    <script>
        // Ø¶Ø¹ Ø±Ø§Ø¨Ø· Ø§Ù„Ø³ÙƒØ±Ø¨Øª Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ Ù‡Ù†Ø§
        const SCRIPT_URL = https://script.google.com/macros/s/AKfycbz96bv2iypBJG0vw7SciUHm7ZTF2IN-Bja4Fl-FBlQy0cQ59pxho6Emj9hFmIRL3MKO/exec;

        document.getElementById('dateField').valueAsDate = new Date();

        function showScreen(id) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(id).classList.add('active');
        }

        function toggleLoader(show) {
            document.getElementById('loader').style.display = show ? 'flex' : 'none';
        }

        // Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯
        document.getElementById('orderForm').onsubmit = async (e) => {
            e.preventDefault();
            toggleLoader(true);
            const params = new URLSearchParams(new FormData(e.target));
            params.append("action", "addOrder");

            fetch(`${SCRIPT_URL}?${params.toString()}`)
                .then(r => r.json())
                .then(() => {
                    toggleLoader(false);
                    alert("âœ… ØªÙ… Ø§Ù„Ø­ÙØ¸ Ø¨Ù†Ø¬Ø§Ø­");
                    e.target.reset();
                    showScreen('mainScreen');
                }).catch(() => {
                    toggleLoader(false);
                    alert("âœ… ØªÙ…Øª Ø§Ù„Ø¹Ù…Ù„ÙŠØ© (ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø´ÙŠØª)");
                });
        };

        // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ ÙˆØ¬Ù„Ø¨ Ø§Ù„Ø¬Ø¯ÙˆÙ„
        document.getElementById('loginForm').onsubmit = async (e) => {
            e.preventDefault();
            toggleLoader(true);
            const user = e.target.username.value;
            const pass = e.target.password.value;

            fetch(`${SCRIPT_URL}?action=login&username=${encodeURIComponent(user)}&password=${encodeURIComponent(pass)}`)
                .then(r => r.json())
                .then(data => {
                    toggleLoader(false);
                    if(data.status === "success") {
                        document.getElementById('welcomeMsg').innerText = "Ù…Ø±Ø­Ø¨Ø§Ù‹: " + data.user;
                        document.getElementById('statOrders').innerText = data.stats.totalOrders;
                        document.getElementById('statAmount').innerText = data.stats.totalAmount + " Ø±.Ø¹";
                        
                        // Ø¨Ù†Ø§Ø¡ Ø§Ù„Ø¬Ø¯ÙˆÙ„
                        let html = `<table><tr>
                            ${data.role === 'admin' ? '<th>Ø§Ù„Ù…Ø·Ø¹Ù…</th>' : ''}
                            <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th><th>Ø§Ù„Ù…ÙƒØ§Ù†</th><th>Ø§Ù„Ø¹Ø¯Ø¯</th><th>Ø§Ù„Ù…Ø¨Ù„Øº</th>
                        </tr>`;
                        
                        data.data.forEach(row => {
                            html += `<tr>
                                ${data.role === 'admin' ? `<td>${row.restaurant}</td>` : ''}
                                <td>${new Date(row.date).toLocaleDateString('en-GB')}</td>
                                <td>${row.location}</td>
                                <td>${row.count}</td>
                                <td>${row.amount}</td>
                            </tr>`;
                        });
                        html += '</table>';
                        document.getElementById('tableContent').innerHTML = html;
                        showScreen('summaryScreen');
                    } else {
                        alert("âŒ Ø§Ù„Ø±Ù…Ø² Ø§Ù„Ø³Ø±ÙŠ ØºÙŠØ± ØµØ­ÙŠØ­");
                    }
                }).catch(() => {
                    toggleLoader(false);
                    alert("Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª");
                });
        };
    </script>
</body>
</html>
